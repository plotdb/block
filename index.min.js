!function(){var win,doc,err,_fetch,rid,sanitize,pubsub,block;function import$(t,e){var n,r={}.hasOwnProperty;for(n in e)r.call(e,n)&&(t[n]=e[n]);return t}function in$(t,e){for(var n=-1,r=e.length>>>0;++n<r;)if(t===e[n])return 1}err=function(t,e){var n;return null==t&&(t=""),null==e&&(e=404),Promise.reject(((n=new Error(t)).name="lderror",n.id=e,n.message=t,n))},_fetch=function(i,t){return block.__node&&"undefined"!=typeof fs&&null!==fs&&!/^https?:/.exec(i)?new Promise(function(n,r){return fs.stat(i,function(t,e){return t?r(t):(t=e.isDirectory()?i+"/index.html":i,fs.readFile(t,function(t,e){return t?r(t):n(e.toString())}))})}):fetch(i,t).then(function(o){return o&&o.ok?o.text():o?o.clone().text().then(function(t){var e,n=o.status||404,r=n+" "+t,i=new Error(r);i.name="lderror",i.id=n,i.message=r,n=i;try{(e=JSON.parse(t))&&"lderror"===e.name&&(import$(n,e).json=e)}catch(t){0}return Promise.reject(n)}):err()})},rid=function(){for(var t;t="b-"+Math.random().toString(36).substring(2),rid.hash[t];);return rid.hash[t]=!0,t},rid.hash={},sanitize=function(t){return t||""},pubsub=function(){return this.subs={},this},pubsub.prototype=import$(Object.create(Object.prototype),{fire:function(t){for(var e,n,r=[],i=1,o=arguments.length;i<o;++i)r.push(arguments[i]);return e=r,Promise.all(((n=this.subs)[t]||(n[t]=[])).map(function(t){return t.apply(null,e)}))},on:function(t,n){var r=this;return(Array.isArray(t)?t:[t]).map(function(t){var e;return((e=r.subs)[t]||(e[t]=[])).push(n)})}}),block={id:function(t){var e;return"string"==typeof t?t:(e=t.path||("js"===t.type?"index.min.js":"css"===t.type?"index.min.css":"index.html"),t.id||t.url||(t.ns?t.ns+":":"")+t.name+"@"+(t.version||"main")+":"+e)},id2obj:function(t){var e,n,r;return(t=t.split(":")).length<=2?(e=t[0],n=t[1],r=t[2]):(r=t[0],e=t[1],n=t[2]),(t=/^(@?[^@]+)(?:@([^:]+))?$/.exec(e))?{ns:r,name:t[1],version:t[2],path:n}:null},env:function(t){t=[t,t.document];if(win=t[0],doc=t[1],rescope.env&&rescope.env(win),rescope.env)return csscope.env(win)},i18n:{module:{lng:"en",t:function(t,e){for(var n,r,i,o,s,c,a,l,u=Array.isArray(t)?t:[t],h=this.lng,p=0,f=u.length;p<f;++p)if(null!=(n=u[p])){for(r=n.indexOf(":"),i=n.substring(0,r),o=(n=n.substring(r+1)).split("."),s=(c=(c=this.res)[h]||(c[h]={}))[i]||(c[i]={}),a=0,l=o.length;a<l&&(r=a,s);++a)s=s[o[r]];if(s)return s}return n||t[t.length-1]},changeLanguage:function(t){return this._fire("languageChanged",this.lng=t)||"en"},addResourceBundle:function(t,e,n,r,i){var o;return((o=this.res)[t]||(o[t]={}))[e]=n},_evthdr:{},on:function(t,n){var r=this;return(Array.isArray(t)?t:[t]).map(function(t){var e;return((e=r._evthdr)[t]||(e[t]=[])).push(n)})},off:function(t,n){var r=this;return(Array.isArray(t)?t:[t]).map(function(t){var e;if(~(e=((e=r._evthdr)[t]||(e[t]=[])).indexOf(n)))return r._evthdr[t].splice(e,1)})},_fire:function(t){for(var e,n,r,i,o=[],s=[],c=1,a=arguments.length;c<a;++c)s.push(arguments[c]);for(e=s,c=0,r=(n=this._evthdr[t]||[]).length;c<r;++c)i=n[c],o.push(i.apply(this,e));return o},res:{}},use:function(t){return this.module=t},addResourceBundle:function(t,e,n,r,i){return block.i18n.module.addResourceBundle(t,e,n,r=null==r?!0:r,i=null==i?!0:i)},changeLanguage:function(t){return block.i18n.module.changeLanguage(t)}}},Object.defineProperty(block.i18n,"language",{get:function(){return block.i18n.module.lng||block.i18n.module.language}}),Object.defineProperty(block.i18n.module,"language",{get:function(){return block.i18n.module.lng}}),block.global={csscope:{hash:{},apply:function(t){var e=this;if((t=t.filter(function(t){return!e.hash[t.id||t.url]}).map(function(t){return e.hash[t.id||t.url]=t.scope})).length)return doc.body.classList.add.apply(doc.body.classList,t)}}},block.init=proxise.once(function(){if(block._rescope)return block._rescope.init()}),block.rescope=function(){return block._rescope||(block._rescope=new rescope({global:null!=win?win:global})),block._rescope},block.csscope=function(){return block._csscope||(block._csscope=new csscope.manager),block._csscope},block.manager=function(t){var e=this;return null==t&&(t={}),this.hash={},this.proxy={},this.running={},this._ver={map:{}},this._chain=t.chain||null,this.init=proxise.once(function(){return e._init()}),this.rescope=t.rescope instanceof rescope?t.rescope:block.rescope(),this.csscope=t.csscope instanceof csscope?t.csscope:block.csscope(),t.registry&&this.registry(t.registry),this.init(),this},block.manager.prototype=import$(Object.create(Object.prototype),{_init:function(){return(this.rescope===block.rescope()?block:this.rescope).init()},id:block.id,id2obj:block.id2obj,chain:function(t,e){return!this._chain||e&&e.replace?this._chain=t:this._chain.chain(t)},registry:function(t){var e;if(null!=(t="string"==(e=typeof t)||"function"==e||t.url||t.fetch?{lib:t,block:t}:t).lib&&(this.rescope===block.rescope()&&(this.rescope=new rescope({global:win})),this.csscope===block.csscope()&&(this.csscope=new csscope.manager),this.rescope.registry(t.lib),this.csscope.registry(t.lib)),null!=t.block&&(this._reg=t.block||"","string"==typeof this._reg&&this._reg&&"/"!==(e=this._reg)[e.length-1]))return this._reg+="/"},set:function(t){var c=this;return null==t&&(t={}),t=Array.isArray(t)?t:"function"!=typeof t[Symbol.iterator]&&isNaN(t.length)?[t]:Array.from(t),Promise.all(t.map(function(t){var e,n,r,i,o,s;return t instanceof win.Element&&(e=t.dataset.bid||"",n=("template"===(t.nodeName||"").toLowerCase()&&t.content.childNodes[0]?t.content.childNodes[0]:t).cloneNode(!0),(e=block.id2obj(e)).block=new block.class({manager:c,root:n}),t=e),n=t.ns,r=t.name,i=t.version,o=t.path,n=n||"",t=t instanceof block.class?t:t.block,o=((o=o)||"index.html").replace(/\/(index\.html)?$/,""),((e=(s=(s=c.hash)[n]||(s[n]={}))[r]||(s[r]={}))[i]||(e[i]={}))[o]=t}))},_getUrl:function(t){var e=t.url,n=t.name,r=t.version,i=t.path,t=t.type;return e||(this._reg||"")+"/assets/block/"+n+"/"+(r||"main")+"/"+(i||("block"===t?"index.html":"js"===t?"index.min.js":"index.min.css"))},getUrl:function(t){var e;return t.type||(t.type="block"),"function"==typeof(e=this._reg.url||this._reg)?e(t):this._getUrl(t)},_ref:function(t){var e,n;return"function"==typeof(e=this._reg.url||this._reg)&&((n=import$({},t)).url=e(t),t=n),this._reg.fetch?this._reg.fetch(t):t.url},fetch:function(t){var e;return t.type="block",(e=this._ref(t))?e.then?e:_fetch(e,{method:"GET"}).then(function(t){return{content:t}}):err(t)},_get:function(e){var t,n,r,i,o=this,s=[e.ns||"",e.name,e.version||"main",e.path||"index.html"],c=s[0],a=s[1],l=s[2],u=s[3],h={ns:c,name:a,version:l,path:u,ctx:e.ctx};if(!a||!l)return err("",1015);if(u=u.replace(/\/(index\.html)?$/,""),(s=(t=this.hash)[c]||(t[c]={}))[a]||(s[a]={}),/[^0-9.]/.exec(l)&&!e.force){if(((s=this._ver.map)[c]||(s[c]={}))[a]&&this._ver.map[c][a][l]&&(i=((s=this.hash[c][a])[i=this._ver.map[c][a][l]]||(s[i]={}))[u]))return i;for(n in s=((t=this.hash)[c]||(t[c]={}))[a])if(r=s[n],semver.fit(n,l))return Promise.resolve(r[u])}return null==((s=this.hash[c][a])[l]||(s[l]={}))[u]||e.force?!0!==((s=(t=(i=this.running)[c]||(i[c]={}))[a]||(t[a]={}))[l]||(s[l]={}))[u]?(this.running[c][a][l][u]=!0,this.fetch({ns:e.ns,name:e.name,version:e.version,path:e.path}).then(function(t){var e;return t?(t.version&&(h.version!==t.version&&(((e=o._ver.map[c])[a]||(e[a]={}))[h.version]=t.version),h.version=t.version),t.content||t):e404(h)}).catch(function(t){return o._chain?o._chain.get(e):Promise.reject(t)}).then(function(t){t=new block.class((h.code=t=null==t?{}:t,h.manager=o,h));return o.set((h.block=t,h)),t}).then(function(t){return o.proxy[c][a][l][u].resolve(t),t}).finally(function(){return o.running[c][a][l][u]=!1}).catch(function(t){return o.proxy[c][a][l][u].reject(t),Promise.reject(t)})):void 0:Promise.resolve(this.hash[c][a][l][u])},from:function(t,n){return this.get(t).then(function(t){return t.create().then(function(e){return e.attach(n).then(function(){return e.interface()}).then(function(t){return{instance:e,interface:t}})})})},get:function(e){var t,c=this;return null==e&&(e={}),t=Array.isArray(e)?e:[e],Promise.all(t.map(function(t){var e,n,r=(e=[(t="string"==typeof(t=null==t?{}:t)?block.id2obj(t):t).ns||"",t.name,t.version||"main",t.path||"index.html"])[0],i=e[1],o=e[2],s=(s=e[3]).replace(/\/(index\.html)?$/,"");return((e=(n=(n=c.proxy)[r]||(n[r]={}))[i]||(n[i]={}))[o]||(e[o]={}))[s]||(c.proxy[r][i][o][s]=proxise(function(t){return c._get(t)})),c.proxy[r][i][o][s](t)})).then(function(t){return Array.isArray(e)?t:t[0]})},debundle:function(t){var n=this;return null==t&&(t={}),t=(t=Array.isArray(t)?t:[t]).map(function(e){return Promise.resolve().then(function(){var l=e.manager||n,u={},t=e.root?Promise.resolve("string"==typeof e.root?doc.querySelector(e.root):e.root):(t=e.url?_fetch(e.url,{method:"GET"}):Promise.resolve(e.code||"")).then(function(t){var e;return block.debundleNode||doc.body.appendChild(block.debundleNode=doc.createElement("div")),block.debundleNode.style.display="none",block.debundleNode.appendChild(e=doc.createElement("div")),e.innerHTML=t,e.querySelector("template")});return t.then(function(t){var n,e,r,i,o,s,c,a=[];if(t){for(e in t.content&&(t=t.content),n=[{},{}][0],Array.from(t.childNodes).map(function(t){var e;if(t.nodeType===doc.ELEMENT_NODE)return"SCRIPT"===t.nodeName?u.script=t.cloneNode(!0):"STYLE"===t.nodeName?u.style=t.cloneNode(!0):(e=t.getAttribute("block"))?n[e]=t:void 0}),u.script&&((t=doc.createElement("script")).textContent=u.script.textContent,u.script=t,u.script.import=function(t){return u.codes="function"==typeof t?t():t},u.script.setAttribute("type","text/javascript"),doc.body.appendChild(u.script)),u.style&&(u.style.setAttribute("type","text/css"),doc.body.appendChild(u.style)),n)r=n[e],c=(s=block.id2obj(e)).ns,i=s.name,o=s.version,s=s.path,c=new block.class({manager:l,ns:c,name:i,version:o,path:s,code:{script:u.codes[e],dom:r,style:""}}),a.push(l.set(c));return a}})})}),Promise.all(t)}}),block.class=function(t){var e,n,r,i,o,s,c=this;if(this.opt=t=null==t?{}:t,this.scope=t.scope||null,this._ctx={},this.csscopes={global:[],local:[]},this.ns=t.ns,this.name=t.name,this.version=t.version,this.path=t.path,this.manager=t.manager,t.ns||(t.ns=""),this.manager||console.warn("manager is mandatory when constructing block.class"),e=t.code,t.root?n="string"==typeof t.root?doc.querySelector(t.root):t.root:"string"==typeof(e="function"==typeof e?e():e)?(e=sanitize(e),(r=doc.createElement("div")).innerHTML=(e||"").trim(),this._templates=Array.from(r.querySelectorAll("template[rel=block]")).map(function(t){return t.parentNode.removeChild(t)}),1<r.childNodes.length&&console.warn("DOM definition of a block should contain only one root.")):"object"==typeof e&&(this.script=e.script,this.style=e.style,this.style=e.style,this.script=e.script,(t=e.dom instanceof Function?e.dom():e.dom)instanceof win.Element?n=t:(e=sanitize(t),(r=doc.createElement("div")).innerHTML=e,1<r.childNodes.length&&console.warn("DOM definition of a block should contain only one root."))),["script","style","link"].map(function(t){var e=Array.from((n||r).querySelectorAll(t)).map(function(t){return t.parentNode.removeChild(t),t.textContent}).join("\n");return c[t]=null!=e&&e?e:c[t]||""}),!n&&r)for(i=0,o=r.childNodes.length;i<o&&(s=i,(n=r.childNodes[s]).nodeType!==win.Element.ELEMENT_NODE);++i);return(n=n||doc.createElement("div")).nodeType!==win.Element.ELEMENT_NODE&&console.warn("root of DOM definition of a block should be an Element"),this.node=n,this.init=proxise.once(function(){return c._init()}),this},block.class.prototype=import$(Object.create(Object.prototype),{_init:function(){var this$=this;return block.init().then(function(){if(this$._templates)return Promise.all(this$._templates.map(function(t){return this$.manager.debundle({root:t})}))}).then(function(){var v,ref$,ret,getClient;return this$.interface=this$.script instanceof Function?this$.script():"object"==typeof this$.script?this$.script:(v=eval("(function(module){"+(this$.script||"")+";return module.exports;})({})"))instanceof Function?v():v||{},this$.interface||(this$.interface={}),(ref$=this$.interface).pkg||(ref$.pkg={}),this$.ns||(this$.ns=this$.interface.pkg.ns),this$.name||(this$.name=this$.interface.pkg.name),this$.version||(this$.version=this$.interface.pkg.version),this$.path||(this$.path=this$.interface.pkg.path),this$.id=block.id({ns:this$.ns,name:this$.name||rid(),version:this$.version||rid(),path:this$.path}),this$._id_t=this$.id.replace(/:/g,"="),this$.scope||(this$.scope=csscope.scope(this$)),this$.style&&(doc.body.appendChild(this$.styleNode=doc.createElement("style")),this$.styleNode.setAttribute("type","text/css"),ret=csscope({rule:"*[scope~="+this$.scope+"]",name:this$.scope,css:this$.style,scopeTest:"[scope]"}),ret=ret.replace(/url\("?(?!data:)([^()"]+)"?\)/g,"url("+this$._path("")+"$1)"),this$.styleNode.textContent=ret),this$.factory=function(t){return this._instance=t,this},getClient=function(t){return this.parent&&this.parent.client instanceof Function?this.parent.client(t):null},this$.factory.prototype=import$((ref$=Object.create(Object.prototype),ref$.init=function(){},ref$.destroy=function(){},ref$._class=this$,ref$.interface=function(){if(this.parent)return this.parent.interface instanceof Function?this.parent.interface():this.parent.interface},ref$.client=getClient,ref$.clients=function(t){return this.parent?this.parent.clients(t).concat(this.client===getClient?[null]:this.client(t)):[this.client(t)]},ref$),this$.interface)}).then(function(){var t,e;if(this$.acceptedHosts=this$.interface.pkg.host||[],this$.extends=[],t=this$.interface.pkg.extend)return this$.manager?(t.name||t.url||(t.ns=this$.ns,t.name=this$.name,t.version=this$.version),this$.opt.ctx&&((e=import$({},t)).ctx=this$.opt.ctx,t=e),this$.manager.get(t).then(function(e){this$.extend=e;try{this$.extend._usedby(this$)}catch(t){throw e=t,this$.extend=null,e}return this$.extendDom=!(null!=t.dom)||t.dom,this$.extendStyle=!(null!=t.style)||t.style,this$.extend.init()}).then(function(){return this$.extends=[this$.extend].concat(this$.extend.extends)})):new Error("no available manager to get extended block")}).then(function(){var t,e,n=[],r=this$.interface.pkg.i18n||{};for(t in r)e=r[t],n.push(block.i18n.module.addResourceBundle(t,this$._id_t,e,!0,!0));return n}).then(function(){var n,r;return this$.dependencies=Array.isArray(this$.interface.pkg.dependencies)?this$.interface.pkg.dependencies:function(){var t,e=[];for(n in t=this.interface.pkg.dependencies||{})r=t[n],e.push(r);return e}.call(this$),this$.dependencies.map(function(t){if(t.name||t.url||(t.ns=this$.ns,t.name=this$.name,t.version=this$.version),!t.type)return!/\.js$/.exec(t.url||t.path||t)&&/\.css$/.exec(t.url||t.path||t)?t.type="css":t.type="js"}),this$.extend?this$._ctx=this$.extend.context():this$.opt.ctx?this$._ctx=this$.opt.ctx:rescope.dualContext?this$._ctx=rescope.dualContext():rescope.proxin&&(this$._ctx=new rescope.proxin),this$.manager.rescope.load(this$.dependencies.filter(function(t){return!t.type||"js"===t.type}),this$._ctx)}).then(function(){return this$.manager.csscope.load(this$.dependencies.filter(function(t){return"css"===t.type&&!0===t.global}))}).then(function(t){return this$.csscopes.global=t||[],this$.manager.csscope.load(this$.dependencies.filter(function(t){return"css"===t.type&&!0!==t.global}))}).then(function(t){if(this$.csscopes.local=t||[],this$.extend)return(t=this$.csscopes).global=t.global.concat(this$.extend.csscopes.global||[]),!0===this$.extendStyle?(t=this$.csscopes).local=t.local.concat(this$.extend.csscopes.local||[]):"overwrite"===this$.extendDom?(t=this$.csscopes).local=t.local.concat(this$.extend.csscopes.local.slice(1)):void 0}).catch(function(t){return console.error("[@plotdb/block] init "+block.id(this$),t),this$.interface={},this$.styleNode={},this$.factory=function(){return this},this$.dependencies=[],this$})},_usedby:function(t){var o,s=this;if(this===t)throw new Error("circular extend");return(this._users||(this._users=[])).push(t),(o=function(t){var e,n,r,i=[];if(in$(s,t=null==t?[]:t))throw new Error("circular extend");for(e=0,n=t.length;e<n;++e)r=t[e],i.push(o(r._users));return i})(t._users)},context:function(){return this._ctx},dom:function(){return this.node},_path:function(t){return null==t&&(t=""),(this.manager.getUrl({ns:this.ns,name:this.name,version:this.version,path:this.path})||"").replace(/\/[^/]*$/,"/")+t},i18n:function(e,t){var n=this._id_t;return e=e.replace(/:/g,""),(block.i18n.module.t([n+":"+e].concat(this.extends.map(function(t){return t._id_t+":"+e}),[e+""]),t)||"").replace(/\uf8ff/g,":")},create:function(e){var n=this;return null==e&&(e={}),this.init().then(function(){var t=new block.instance({block:n,data:e.data,host:e.host,ns:n.ns,name:n.name,path:n.path,version:n.version});return t.init().then(function(){if(e.root)return t.attach({root:e.root,before:e.before,host:e.host,autoTransform:e.autoTransform||null})}).then(function(){return t})})},resolvePlugAndCloneNode:function(n,t){var e;return(t=null==t?!1:t)?e=n:(e=this.dom().cloneNode(!0),Array.from(e.querySelectorAll("plug")).forEach(function(t){var e=t.getAttribute("name");return n&&(e=n.querySelector(":scope :not([plug]) [plug="+e+"], :scope > [plug="+e+"]"))?t.replaceWith(e):void 0}),Array.from(e.querySelectorAll("plug")).forEach(function(t){var e,n,r,i,o,s=t.getAttribute("name");for(t.removeAttribute("name"),t.setAttribute("plug",s),e=doc.createElement("div"),n=0,i=(r=t.attributes).length;n<i;++n)o=r[n],e.setAttribute(o.name,o.value);for(;t.firstChild;)e.appendChild(t.firstChild);return t.replaceWith(e)})),this.extend&&!1!==this.extendDom?"overwrite"===this.extendDom?this.extend.resolvePlugAndCloneNode(e,!0):this.extend.resolvePlugAndCloneNode(e):e}}),block.instance=function(t){var e=this;return this.ns=(t=null==t?{}:t).ns,this.name=t.name,this.version=t.version,this.path=t.path,this.block=t.block,this.data=t.data,this.init=proxise.once(function(){return e._init()}),this},block.instance.prototype=import$(Object.create(Object.prototype),{_init:function(){return this.block.init()},attach:function(t){var e,n,r,i,o,s,c,a,l,u,h,p,f,d=this;if(null==t&&(t={}),a=this._defered)return a.before?a.root.insertBefore(a.node,a.before):a.root.appendChild(a.node),Promise.resolve();if(t.data&&(this.data=t.data),this.host=(Array.isArray(t.host)?t.host:[t.host]).filter(function(t){return t}),t.i18n)for(this._i18nModule=t.i18n,n=(e=[this.block].concat(this.block.extends)).length-1;0<=n;--n)for(s in o=(i=e[r=n]).interface.pkg.i18n||{})c=o[s],this._i18nModule.addResourceBundle(s,i._id_t,c,!0,!0);else this._i18nModule=block.i18n.module;if(a=(a=t.root)?"string"==typeof a?doc.querySelector(a):a:null,block.global.csscope.apply(this.block.csscopes.global),a){for(l=this.dom(t.root),u=[this.block].concat(this.block.extends),h=[this.block.scope],n=0,p=u.length-1;n<p;++n)if("overwrite"!==(f=u[r=n].extendStyle)){if(!1===f)break;h.push(u[r+1].scope)}l.setAttribute("scope",h.join(" ")),l.classList.add.apply(l.classList,this.block.csscopes.local.map(function(t){return t.scope}).concat(this.block.csscopes.global.map(function(t){return t.scope}))),t.defer?this._defered={node:l,root:a,before:t.before}:t.before?a.insertBefore(l,t.before):a.appendChild(l)}else l=null;return"i18n"===t.autoTransform&&this._i18nModule.on("languageChanged",this._i18nTransform=function(){return d.transform("i18n")}),this.run({node:l,type:"init"})},detach:function(){var t=this.dom();return t.parentNode.removeChild(t),this._i18nTransform&&(this._i18nModule.off("languageChanged",this._i18nTransform),this._i18nTransform=null),this.run({node:t,type:"destroy"})},interface:function(){var t;return(t=this.obj)[t.length-1].interface()},client:function(t){var e;return(e=this.obj)[e.length-1].client(t)},clients:function(t){var e;return(e=this.obj)[e.length-1].clients(t)},_transform:function(t,a,l){var u=new RegExp("^"+a+"-(.+)$"),h=function(t){var e,n,r,i,o,s,c=[];if(t.nodeType===win.Element.TEXT_NODE)return t.parentNode.setAttribute(a,t.textContent),t.parentNode.replaceChild(doc.createTextNode(l(t.textContent)),t);for(e=0,n=t.attributes.length;e<n;++e)r=e,o=(i=t.attributes[r]).name,i=i.value,(o=u.exec(o))&&t.setAttribute(o[1],l(i||""));if(s=t.getAttribute(a))return t.textContent=l(s);for(e=0,n=t.childNodes.length;e<n;++e)r=e,c.push(h(t.childNodes[r]));return c},e=new WeakMap;return Array.from(t.querySelectorAll(":scope [scope] ["+a+"]")).map(function(t){return e.set(t,1)}),Array.from(t.querySelectorAll("["+a+"]")).filter(function(t){return!e.get(t)}).map(h),t},transform:function(t){var e=this;if("i18n"===t||"path"===t)return this._transform(this.node,"t",function(t){return e.i18n(t)}),this._transform(this.node,"path",function(t){return e._path(t)})},dom:function(t){var e;return(e=this.node)||(this.node=this.block.resolvePlugAndCloneNode(t),this.transform("i18n"),this.transform("path"))},_path:function(t){return this.block._path(t)},_gethost:function(t){var n=t.host,t=t.accept,e=(Array.isArray(t)?t:[t]).filter(function(t){return t});return e.length?(e=e.map(function(e){return(n||[]).filter(function(t){return(t.bid?block.id2obj(t.bid):t).name===e.name})[0]}),Array.isArray(t)?e:e[0]||null):n},i18n:function(t,e){var n,r;return this._i18nModule?(n=this.block._id_t,r=t.replace(/:/g,""),(this._i18nModule.t([n+":"+r].concat(this.block.extends.map(function(t){return t._id_t+":"+r}),[r+""]),e)||"").replace(/\uf8ff/g,":")):this.block.i18n(t,e)},run:function(t){var p,f=this,d=t.node,m=t.type,e=[],b=[],n=this.block;for(this.obj||(this.obj=[]),this.pubsub||(this.pubsub=new pubsub),p={t:function(t,e){return f.i18n(t,e)},on:function(t,e){return f._i18nModule.on(t,e)},getLanguage:function(){return f._i18nModule.language},addResourceBundles:function(t){var e,n,r=[];for(e in t=null==t?{}:t)n=t[e],r.push(f._i18nModule.addResourceBundle(e,f.block._id_t,n,!0,!0));return r}},Object.defineProperty(p,"language",{get:function(){return f._i18nModule.language}});n;)e=[n].concat(e),n=n.extend;return new Promise(function(l,u){var h=function(t,e,n,r,i){var o,s,c,a;return null==e&&(e=0),null==n&&(n={}),(t=null==t?[]:t).length<=e?Promise.all(b).then(function(t){return l(t)}).catch(function(t){return u(t)}):(o=t[e],s=o._ctx.ctx?o._ctx.ctx():(s=o._ctx).local||(s.local={}),import$(n,s),s={root:d,parent:r,manager:f.block.manager,ctx:n,context:n,pubsub:f.pubsub,i18n:p,t:function(t,e){return f.i18n(t,e)},path:function(t){return f._path(t)},data:f.data,host:f._gethost({host:f.host,accept:o.acceptedHosts})},"init"===m&&(f.obj.push(c=new o.factory(f.block===o?f:null)),c.parent=f.obj[e-1]),(c=f.obj[e])&&b.push(a=c[m](s)),o.interface.pkg.syncInit&&a?Promise.resolve(a).then(function(){return h(t,e+1,n,c)}):h(t,e+1,n,c))};return h(e,0,{})})}}),block.env("undefined"!=typeof self&&null!==self?self:globalThis),"undefined"!=typeof module&&null!==module?module.exports=block:"undefined"!=typeof window&&null!==window&&(window.block=block)}();
