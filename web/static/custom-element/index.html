<!DOCTYPE html><html><head><style type="text/css">.red{background:red}</style></head><body><template block="root"><div class="blah"><plug name="main"><h1>hello2</h1></plug><hr><p class="red">this is a block.</p></div></template><template block="child"><div plug="main"><h1 class="red">a child</h1><input type="submit" value="ok"><input name="inside" value="inside"></div></template><form id="form" method="post" action="/"><input class="red" type="submit" value="ok"><input name="outside" value="outside"></form><script src="/assets/lib/@plotdb/datadom/main/datadom.min.js"></script><script>var block,root,child,ret,dd;document.body.addEventListener("click",function(e){return console.log(e.target)});block=function(e){var t,o,n=this;e==null&&(e={});this.name=e.name;this.extend=e.extend;this.template=document.querySelector("template[block="+this.name+"]").content;this.template=this.template.cloneNode(true);if(t=block.useCe){if(this.extend){o=document.createElement("block-"+this.extend.name);o.appendChild(this.template);this.template=o}this.ce=function(){var e,t;e=Reflect.construct(HTMLElement,[],n.ce);t=e.attachShadow({mode:"open"});t.appendChild(n.template.cloneNode(true));return e};t=this;this.ce.prototype=Object.create(HTMLElement.prototype);this.ce.prototype.prototype=HTMLElement.prototype;customElements.define("block-"+this.name,this.ce)}return this};block.prototype=import$(Object.create(Object.prototype),{resolvePlugAndCloneNode:function(n){var e;e=this.template.cloneNode(true);if(n){Array.from(e.querySelectorAll("plug")).map(function(e){var t,o;t=e.getAttribute("name");o=n.querySelector("[plug="+t+"]");return e.replaceWith(o)})}return this.extend?this.extend.resolvePlugAndCloneNode(e):e},createDom:function(){var e;if(block.useCe){return this.node=document.createElement("block-"+this.name)}e=this.resolvePlugAndCloneNode().childNodes[0];e.parentNode.removeChild(e);return this.node=e},attach:function(){var e;e=this.createDom();form.appendChild(e);return e}});block.useCe=false;root=new block({name:"root"});child=new block({name:"child",extend:root});ret=child.attach();dd=new datadom({node:ret});dd.init().then(function(){var e;console.log(dd);e=document.body.querySelector("block-child");return console.log(e)});function import$(e,t){var o={}.hasOwnProperty;for(var n in t)if(o.call(t,n))e[n]=t[n];return e}</script></body></html>