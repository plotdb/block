<!DOCTYPE html><html><head><style type="text/css">.red {
  background: #f00;
}
</style></head><body><template block="root"><div class="blah"><plug name="main"><h1>hello2</h1></plug><hr><p class="red">this is a block.</p></div></template><template block="child"><div plug="main"><h1 class="red">a child</h1><input type="submit" value="ok"><input name="inside" value="inside"></div></template><form id="form" method="post" action="/"><input class="red" type="submit" value="ok"><input name="outside" value="outside"></form><script src="/assets/lib/@plotdb/datadom/main/datadom.min.js"></script><script>var block, root, child, ret, dd;
document.body.addEventListener('click', function(it){
  return console.log(it.target);
});
block = function(opt){
  var that, n, this$ = this;
  opt == null && (opt = {});
  this.name = opt.name;
  this.extend = opt.extend;
  this.template = document.querySelector("template[block=" + this.name + "]").content;
  this.template = this.template.cloneNode(true);
  if (that = block.useCe) {
    if (this.extend) {
      n = document.createElement("block-" + this.extend.name);
      n.appendChild(this.template);
      this.template = n;
    }
    this.ce = function(){
      var root, shadow;
      root = Reflect.construct(HTMLElement, [], this$.ce);
      shadow = root.attachShadow({
        mode: 'open'
      });
      shadow.appendChild(this$.template.cloneNode(true));
      return root;
    };
    that = this;
    this.ce.prototype = Object.create(HTMLElement.prototype);
    this.ce.prototype.prototype = HTMLElement.prototype;
    customElements.define("block-" + this.name, this.ce);
  }
  return this;
};
block.prototype = import$(Object.create(Object.prototype), {
  resolvePlugAndCloneNode: function(child){
    var node;
    node = this.template.cloneNode(true);
    if (child) {
      Array.from(node.querySelectorAll('plug')).map(function(it){
        var name, n;
        name = it.getAttribute('name');
        n = child.querySelector("[plug=" + name + "]");
        return it.replaceWith(n);
      });
    }
    return this.extend ? this.extend.resolvePlugAndCloneNode(node) : node;
  },
  createDom: function(){
    var ret;
    if (block.useCe) {
      return this.node = document.createElement("block-" + this.name);
    }
    ret = this.resolvePlugAndCloneNode().childNodes[0];
    ret.parentNode.removeChild(ret);
    return this.node = ret;
  },
  attach: function(){
    var ret;
    ret = this.createDom();
    form.appendChild(ret);
    return ret;
  }
});
block.useCe = false;
root = new block({
  name: 'root'
});
child = new block({
  name: 'child',
  extend: root
});
ret = child.attach();
dd = new datadom({
  node: ret
});
dd.init().then(function(){
  var ret;
  console.log(dd);
  ret = document.body.querySelector('block-child');
  return console.log(ret);
});
function import$(obj, src){
  var own = {}.hasOwnProperty;
  for (var key in src) if (own.call(src, key)) obj[key] = src[key];
  return obj;
}</script></body></html>