var lc,wrap,serialize,deserialize,locate,update,opt,je,blocks,block,b,nt,nt2,ops,opsIn;lc={json:{}},Array.from(document.querySelectorAll("button")).map(function(e){return e.addEventListener("click",function(){return alert("ok")})}),wrap=function(e){var t,n,r,o,l,s;return"#text"===(t=e.nodeName.toLowerCase())?{type:"text",value:e.nodeValue}:(n=e.style?function(){var t,n,o=[];for(t=0,n=e.style.length;t<n;++t)r=t,o.push(r);return o}().map(function(t){return[e.style[t],e.style[e.style[t]]]}):[],o=e.attributes?function(){var t,n,r,o=[];for(t=0,r=(n=e.attributes).length;t<r;++t)l=n[t],o.push([l.nodeName,l.nodeValue]);return o}().filter(function(e){var t;return!("style"===(t=e[0])||"class"===t)}):[],s=e.classList?function(){var t,n,r,o=[];for(t=0,r=(n=e.classList).length;t<r;++t)l=n[t],o.push(l);return o}():[],{type:"tag",name:t,style:n,attr:o,cls:s})},serialize=function(e){var t,n,r,o,l,s;if(t=wrap(e),n=[],e.childNodes){for(r=0,o=e.childNodes.length;r<o;++r)l=r,s=serialize(e.childNodes[l]),n.push(s);return t.child=n,t}},deserialize=function(e){var t,n,r,o,l;if("text"===e.type)return document.createTextNode(e.value);if("block"===e.type)return deserialize(e.tree);for(t=document.createElement(e.name),e.attr.filter(function(e){return e&&e[0]}).map(function(e){return t.setAttribute(e[0],e[1])}),e.style.filter(function(e){return e&&e[0]}).map(function(e){return t.style[e[0]]=e[1]}),e.cls&&e.cls.length&&t.classList.add.apply(t.classList,e.cls.filter(function(e){return e})),n=0,o=(r=e.child||[]).length;n<o;++n)(l=deserialize(r[n]))&&t.appendChild(l);return t},locate=function(e,t,n){var r,o,l,s,i,u,a,c;for(r=n,o=t,console.log(e.p,e),l=e.p.length-1;l>=0&&(s=l,"attr"!==(i=e.p[s])&&"style"!==i&&"cls"!==i&&"child"!==i&&"name"!==i&&"value"!==i&&"type"!==i);--l);for(l=0,u=s-1;l<u;++l)l,a=e.p[s],r="child"===a?r.childNodes:r,o=o[a];switch(e.p[s]){case"name":case"value":case"type":return c=deserialize(o),r.parentNode.insertBefore(c,r),r.parentNode.removeChild(r);case"style":return r.setAttribute("style",""),o.style.map(function(e){return r.style[e[0]]=e[1]});case"cls":return r.setAttribute("class",o.cls.join(" "));case"attr":return Array.from(r.attributes).map(function(e){var t;if(!o.attr[e.name]&&"block"!==(t=e.name)&&"style"!==t&&"class"!==t)return r.removeAttribute(e.name)}),o.attr.map(function(e){return r.setAttribute(e[0],e[1])});case"child":if(e.ld&&r.removeChild(r.childNodes[e.p[s+1]]),e.li)return c=deserialize(e.li),r.insertBefore(c,r.childNodes[e.p[s+1]])}},update=function(e){var t;return null==e&&(e=[]),e.length?e.map(function(e){return locate(e,lc.json,out.childNodes[0])}):(t=deserialize(lc.json),out.innerHTML="",out.appendChild(t))},opt={onChange:function(){var e,t;return e=je.get(),t=json0OtDiff(lc.json,e),sharedb.types.defaultType.apply(lc.json,t),update(t)}},je=new JSONEditor(editor,opt),blocks={hash:{},add:function(e,t){return this.hash[e]=t},get:function(e){return this.hash[e]}},b=new(block=function(e){return null==e&&(e={}),this.name=e.name,this.tree=serialize(e.root),blocks.add(name,this),this})({name:"two-button",root:ld$.find("[block]",0)}),lc.json=nt=JSON.parse(JSON.stringify(b.tree)),nt2=JSON.parse(JSON.stringify(b.tree)),ops=[{p:["child",4],li:{type:"block",tree:nt2}},{p:["style",0],li:["background","yellow"]},{p:["cls",0],li:"text-danger"},{p:["attr",0],li:["data-name","blah"]},{p:["attr",0],ld:["data-name","blah"]}],je.set(lc.json),update(),opsIn=function(e,t){return null==t&&(t=!0),sharedb.types.defaultType.apply(lc.json,e),je.set(lc.json),update(e)},debounce(1e3).then(function(){return opsIn([ops[0]])}).then(function(){return ld$.find("button").map(function(e){return e.addEventListener("click",function(){return alert("ok")})})}).then(function(){return debounce(1e3)}).then(function(){return opsIn([ops[1]])}).then(function(){return debounce(1e3)}).then(function(){return opsIn([ops[2]])}).then(function(){return debounce(1e3)}).then(function(){return opsIn([ops[3]])}).then(function(){return debounce(1e3)}).then(function(){return opsIn([ops[4]])}).then(function(){return debounce(1e3)});