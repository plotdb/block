function import$(e,t){var n={}.hasOwnProperty;for(var r in t)n.call(t,r)&&(e[r]=t[r]);return e}var lc,wrap,serialize,deserialize,locate,update,opt,je,blocks,block,b,nt,nt2,ops,opsIn;lc={json:{}},Array.from(document.querySelectorAll("button")).map(function(e){return e.addEventListener("click",function(){return alert("ok")})}),wrap=function(e){var t,n,r,o,i,u;return"#text"===(t=e.nodeName.toLowerCase())?{type:"text",value:e.nodeValue}:(n=e.style?function(){var t,n,o=[];for(t=0,n=e.style.length;t<n;++t)r=t,o.push(r);return o}().map(function(t){return[e.style[t],e.style[e.style[t]]]}):[],o=e.attributes?function(){var t,n,r,o=[];for(t=0,r=(n=e.attributes).length;t<r;++t)i=n[t],o.push([i.nodeName,i.nodeValue]);return o}().filter(function(e){var t;return!("style"===(t=e[0])||"class"===t)}):[],u=e.classList?function(){var t,n,r,o=[];for(t=0,r=(n=e.classList).length;t<r;++t)i=n[t],o.push(i);return o}():[],{type:"tag",name:t,style:n,attr:o,cls:u})},serialize=function(e){var t,n,r,o,i,u;if(t=wrap(e),n=[],e.childNodes){for(r=0,o=e.childNodes.length;r<o;++r)i=r,u=serialize(e.childNodes[i]),n.push(u);return t.child=n,t}},deserialize=function(e){var t;return t=[],Promise.resolve().then(function(){var n;return(n=function(e){var r,o,i,u,a;if("text"===e.type)return document.createTextNode(e.value);if("block"===e.type)return function(){var n;return n=document.createElement("div"),n.textContent="loading...",t.push(debounce(2e3).then(function(){return blocks.get(e.name)}).then(function(e){return e.instantiate().then(function(e){var t,r;return(t=n.parentNode)?((r=t).insertBefore(e.node,n),r.removeChild(n),r):e})}).catch(function(){return n.innerText="load fail."})),n}();for(r=document.createElement(e.name),e.attr.filter(function(e){return e&&e[0]}).map(function(e){return r.setAttribute(e[0],e[1])}),e.style.filter(function(e){return e&&e[0]}).map(function(e){return r.style[e[0]]=e[1]}),e.cls&&e.cls.length&&r.classList.add.apply(r.classList,e.cls.filter(function(e){return e})),o=0,u=(i=e.child||[]).length;o<u;++o)(a=n(i[o]))&&r.appendChild(a);return r})(e)}).then(function(e){return{node:e,promise:Promise.all(t)}})},locate=function(e,t,n){var r,o,i,u,a,l,s;for(r=n,o=t,console.log(e.p,e),i=e.p.length-1;i>=0&&(u=i,"attr"!==(a=e.p[u])&&"style"!==a&&"cls"!==a&&"child"!==a&&"name"!==a&&"value"!==a&&"type"!==a);--i);for(i=0,l=u-1;i<l;++i)i,s=e.p[u],r="child"===s?r.childNodes:r,o=o[s];switch(e.p[u]){case"name":case"value":case"type":return deserialize(o).then(function(e){var t;return t=e.node,e.promise,r.parentNode.insertBefore(t,r),r.parentNode.removeChild(r)});case"style":return r.setAttribute("style",""),o.style.map(function(e){return r.style[e[0]]=e[1]});case"cls":return r.setAttribute("class",o.cls.join(" "));case"attr":return Array.from(r.attributes).map(function(e){var t;if(!o.attr[e.name]&&"block"!==(t=e.name)&&"style"!==t&&"class"!==t)return r.removeAttribute(e.name)}),o.attr.map(function(e){return r.setAttribute(e[0],e[1])});case"child":if(e.ld&&r.removeChild(r.childNodes[e.p[u+1]]),e.li)return deserialize(e.li).then(function(t){var n;return n=t.node,t.promise,r.insertBefore(n,r.childNodes[e.p[u+1]])})}},update=function(e){return null==e&&(e=[]),e.length?e.map(function(e){return locate(e,lc.json,out.childNodes[0])}):deserialize(lc.json).then(function(e){var t;return t=e.node,e.promise,out.innerHTML="",out.appendChild(t)})},opt={onChange:function(){var e,t;return e=je.get(),t=json0OtDiff(lc.json,e),sharedb.types.defaultType.apply(lc.json,t),update(t)}},je=new JSONEditor(editor,opt),blocks={hash:{},add:function(e,t){return this.hash[e]=t},get:function(e){return Promise.resolve(this.hash[e])}},(block=function(e){return null==e&&(e={}),this.name=e.name,this.tree=serialize(e.root),blocks.add(name,this),this}).prototype=import$(Object.create(Object.prototype),{instantiate:function(){return deserialize(this.tree)}}),b=new block({name:"two-button",root:ld$.find("[block]",0)}),blocks.add("two-button",b),lc.json=nt=JSON.parse(JSON.stringify(b.tree)),nt2=JSON.parse(JSON.stringify(b.tree)),ops=[{p:["child",4],li:{type:"block",name:"two-button"}},{p:["style",0],li:["background","yellow"]},{p:["cls",0],li:"text-danger"},{p:["attr",0],li:["data-name","blah"]},{p:["attr",0],ld:["data-name","blah"]}],je.set(lc.json),update(),opsIn=function(e,t){return null==t&&(t=!0),sharedb.types.defaultType.apply(lc.json,e),je.set(lc.json),update(e)},debounce(1e3).then(function(){return opsIn([ops[0]])}).then(function(){return ld$.find("button").map(function(e){return e.addEventListener("click",function(){return alert("ok")})})}).then(function(){return debounce(1e3)}).then(function(){return opsIn([ops[1]])}).then(function(){return debounce(1e3)}).then(function(){return opsIn([ops[2]])}).then(function(){return debounce(1e3)}).then(function(){return opsIn([ops[3]])}).then(function(){return debounce(1e3)}).then(function(){return opsIn([ops[4]])}).then(function(){return debounce(1e3)});