var wrap,serialize,deserialize,locate;wrap=function(e){var t,r,n,i,a,l;return"#text"===(t=e.nodeName.toLowerCase())?{type:"text",value:e.nodeValue}:(r=e.style?function(){var t,r,i=[];for(t=0,r=e.style.length;t<r;++t)n=t,i.push(n);return i}().map(function(t){return[e.style[t],e.style[e.style[t]]]}):[],i=e.attributes?function(){var t,r,n,i=[];for(t=0,n=(r=e.attributes).length;t<n;++t)a=r[t],i.push([a.nodeName,a.nodeValue]);return i}().filter(function(e){var t;return!("style"===(t=e[0])||"class"===t)}):[],l=e.classList?function(){var t,r,n,i=[];for(t=0,n=(r=e.classList).length;t<n;++t)a=r[t],i.push(a);return i}():[],{type:"tag",name:t,style:r,attr:i,cls:l})},serialize=function(e){var t,r,n,i,a,l;if(t=wrap(e),r=[],e.childNodes){for(n=0,i=e.childNodes.length;n<i;++n)a=n,l=serialize(e.childNodes[a]),r.push(l);return t.child=r,t}},deserialize=function(e){var t;return t=[],Promise.resolve().then(function(){var r;return(r=function(e){var n,i,a,l,s;if("text"===e.type)return document.createTextNode(e.value);if("block"===e.type)return function(){var r;return r=document.createElement("div"),r.textContent="loading...",t.push(debounce(2e3).then(function(){return blockManager.get({name:e.name,version:e.version})}).then(function(e){return e.instantiate().then(function(e){var t,n;return(t=r.parentNode)?((n=t).insertBefore(e.node,r),n.removeChild(r),n):e})}).catch(function(){return console.log("block-manager.get failed in deserialize ( "+e.name+"@"+e.version+" )"),r.innerText="load fail."})),r}();for(n=document.createElement(e.name),e.attr.filter(function(e){return e&&e[0]}).map(function(e){return n.setAttribute(e[0],e[1])}),e.style.filter(function(e){return e&&e[0]}).map(function(e){return n.style[e[0]]=e[1]}),e.cls&&e.cls.length&&n.classList.add.apply(n.classList,e.cls.filter(function(e){return e})),i=0,l=(a=e.child||[]).length;i<l;++i)(s=r(a[i]))&&n.appendChild(s);return n})(e)}).then(function(e){return{node:e,promise:Promise.all(t)}})},locate=function(e,t,r){var n,i,a,l,s,o,u;for(n=r,i=t,a=e.p.length-1;a>=0&&(l=a,"attr"!==(s=e.p[l])&&"style"!==s&&"cls"!==s&&"child"!==s&&"name"!==s&&"value"!==s&&"type"!==s);--a);for(a=0,o=l-1;a<o;++a)a,u=e.p[l],n="child"===u?n.childNodes:n,i=i[u];switch(e.p[l]){case"name":case"value":case"type":return deserialize(i).then(function(e){var t;return t=e.node,e.promise,n.parentNode.insertBefore(t,n),n.parentNode.removeChild(n)});case"style":return n.setAttribute("style",""),i.style.map(function(e){return n.style[e[0]]=e[1]});case"cls":return n.setAttribute("class",i.cls.join(" "));case"attr":return Array.from(n.attributes).map(function(e){var t;if(!i.attr[e.name]&&"block"!==(t=e.name)&&"style"!==t&&"class"!==t)return n.removeAttribute(e.name)}),i.attr.map(function(e){return n.setAttribute(e[0],e[1])});case"child":if(e.ld&&n.removeChild(n.childNodes[e.p[l+1]]),e.li)return deserialize(e.li).then(function(t){var r;return r=t.node,t.promise,n.insertBefore(r,n.childNodes[e.p[l+1]])})}};