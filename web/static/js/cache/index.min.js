!function(){var tmp,node,_bundle,bundle,parseBundle,mgr,obj,testload,this$=this;return window.blah=function(e){return this$.code=e()},tmp=ld$.find("template",0),node=tmp.content,_bundle=function(list,blocks,deps){var bd;return(null==blocks&&(blocks=[]),null==deps&&(deps=[]),list.length)?(bd=list.splice(0,1)[0],console.log("block def: ",bd),ld$.fetch(mgr.getUrl(bd),{method:"GET"},{type:"text"}).then(function(it){var node,id,js,css,ret,node=document.createElement("div");return node.innerHTML=it,1<node.childNodes.length&&console.warn("DOM definition of a block should contain only one root."),id=bd.name+"@"+bd.version+":"+(bd.path||"index.html"),js=Array.from(node.querySelectorAll("script")).map(function(e){return e.parentNode.removeChild(e),e.textContent}).join("\n"),css=Array.from(node.querySelectorAll("style")).map(function(e){return e.parentNode.removeChild(e),e.textContent}).join("\n"),node.childNodes[0].setAttribute("block",id),ret=eval(js)||{},(ret.pkg||(ret.pkg={})).extend&&list.push((ret.pkg||(ret.pkg={})).extend),deps=deps.concat(((ret.pkg||(ret.pkg={})).dependencies||[]).filter(function(e){return"js"===e.type||/\.js/.exec(e.path||e||"")})),blocks.push({js:js,css:css,html:node.innerHTML,bd:bd,id:id}),_bundle(list,blocks,deps)})):Promise.resolve({blocks:blocks,deps:deps})},bundle=function(e){var t=(e=null==e?{}:e).manager;return _bundle(e.blocks||(e.blocks=[])).then(function(e){var r=e.blocks,e=e.deps;return t.rescope.bundle(e).then(function(e){var t,n=r.map(function(e){return'"'+e.id+'": '+(e.js||'""').replace(/;$/,"")}).join(",\n");return n="document.currentScript.import({"+n+"});",t=r.map(function(e){var t="_"+btoa(e).replace(/=/g,"_");return csscope({rule:"*[scope~="+t+"]",name:t,css:e.css||"",scopeTest:"[scope]"})}).join("\n"),"<template>\n  "+r.map(function(e){return e.html||""}).join("\n")+'\n  <style type="text/css">'+t+'</style>\n  <script type="text/javascript">'+n+e+"<\/script>\n</template>"}).then(function(e){return e})})},parseBundle=function(e){var t,n,r,o,s,i=this;for(n in this.root=t="string"==typeof(e=null==e?{}:e).root?document.querySelector(e.root):e.root,t.content&&(this.root=t=t.content),this.nodes={},this.classes={},this.codes={},this.mgr=e.manager,this.nodes={},this.classes={},Array.from(t.childNodes).map(function(e){var t;if(e.nodeType===Document.ELEMENT_NODE)return"SCRIPT"===e.nodeName?i.script=e.cloneNode(!0):"STYLE"===e.nodeName?i.style=e.cloneNode(!0):(t=e.getAttribute("block"))?i.nodes[t]=e:void 0}),this.script&&((t=document.createElement("script")).textContent=this.script.textContent,this.script=t,this.script.import=function(e){return i.codes=e},this.script.setAttribute("type","text/javascript"),document.body.appendChild(this.script)),this.style&&(this.style.setAttribute("type","text/css"),document.body.appendChild(this.style)),r=this.nodes)s=r[n],o=[(o=/^(@?[^@]+)@([^:]+)(:.+)?/.exec(n))[1],o[2],(o[3]||"").replace(/^:/,"")||""],this.classes[n]=s=new block.class({manager:this.mgr,name:o[0],version:o[1],path:o[2],code:{script:this.codes[n],dom:s,style:""}}),this.mgr.set(s);return this},mgr=new block.manager({registry:function(e){var t=e.name,n=e.version,r=e.path;e.type;return"/block/"+t+"/"+n+"/"+(r||"index.html")}}),obj=parseBundle.call({},{root:ld$.find("template",0),manager:mgr}),testload=function(e){return mgr.get(e).then(function(e){return e.create().then(function(e){return e.attach({root:container}).then(function(){return e.interface()})})})},mgr.get({name:"@plotdb/sample1",version:"main"}).then(function(e){return e.create().then(function(e){return e.attach({root:container}).then(function(){return e.interface()})})}),mgr.get({name:"@plotdb/sample2",version:"main"}).then(function(e){return e.create().then(function(e){return e.attach({root:container}).then(function(){return e.interface()})})}),ld$.fetch("/assets/bundle/bundle-2.html",{method:"GET"},{type:"text"}).then(function(e){var t=document.createElement("div");return t.innerHTML=e,document.body.appendChild(t),parseBundle.call({},{root:ld$.find(t,"template",0),manager:mgr})}).then(function(){return testload({name:"cta",version:"0.0.1",path:"index.html"}),testload({name:"long-answer",version:"0.0.1",path:"index.html"})})}.apply({});