// Generated by LiveScript 1.3.1
var highlightHandler, hlh;
highlightHandler = function(opt){
  opt == null && (opt = {});
  this.opt = opt;
  this.box = null;
  this.tgt = null;
  this.menu = opt.menu;
  this.target = opt.target;
  return this;
};
highlightHandler.prototype = import$(Object.create(Object.prototype), {
  isToggled: function(){
    return this.toggled;
  },
  toggle: function(v, e){
    var ref$, box, ref1$, ref2$, ref3$;
    this.toggled = v = v != null
      ? v
      : !this.isToggled();
    if (!v) {
      return ref$ = this.menu.style, ref$.opacity = 0, ref$.pointerEvents = 'none', ref$;
    }
    box = this.menu.getBoundingClientRect();
    return ref$ = this.menu.style, ref$.opacity = 1, ref$.pointerEvents = 'auto', ref$.left = ((ref1$ = (ref3$ = e.clientX - box.width / 2) > 0 ? ref3$ : 0) < (ref2$ = window.innerWidth - box.width) ? ref1$ : ref2$) + "px", ref$.top = ((ref1$ = (ref3$ = e.clientY - box.height / 2) > 0 ? ref3$ : 0) < (ref2$ = window.innerHeight - box.height) ? ref1$ : ref2$) + "px", ref$;
  },
  poll: function(){
    var this$ = this;
    this.render(this.tgt);
    return setTimeout(function(){
      return this$.poll();
    }, 500);
  },
  init: function(){
    var this$ = this;
    setInterval(function(){
      return this$.render(this$.tgt);
    }, 500);
    this.box = document.createElement('div');
    this.tgt = null;
    import$(this.box.style, {
      position: 'fixed',
      top: 0,
      left: 0,
      zIndex: 9999,
      pointerEvents: 'none',
      opacity: 0,
      transition: "all .15s ease-in-out",
      animation: "highlight 1s infinite"
    });
    document.body.appendChild(this.box);
    document.addEventListener('mouseover', function(e){
      var node;
      if (!ld$.parent(e.target, null, this$.target)) {
        return;
      }
      if (this$.isToggled()) {
        return;
      }
      if (!(node = ld$.parent(e.target, '[editable]'))) {
        return;
      }
      return this$.render(node);
    });
    document.addEventListener('click', function(e){
      return this$.toggle(false);
    });
    document.addEventListener('contextmenu', function(e){
      this$.toggle(true, e);
      return e.preventDefault();
    });
    this.view = new ldView({
      root: this.menu,
      action: {
        click: {
          'highlight-delete': function(){
            var tgt, prev;
            tgt = this$.tgt;
            if (!(tgt && tgt.parentNode)) {
              return;
            }
            prev = tgt.previousSibling || tgt.parentNode;
            if (!prev.hasAttribute('editable')) {
              prev = null;
            }
            tgt.parentNode.removeChild(tgt);
            this$.tgt = prev;
            return this$.render(prev);
          },
          'highlight-clone': function(){
            var tgt, cloned;
            tgt = this$.tgt;
            if (!(tgt && tgt.parentNode)) {
              return;
            }
            cloned = tgt.cloneNode(true);
            tgt.parentNode.insertBefore(cloned, tgt.nextSibling);
            this$.tgt = cloned;
            return this$.render(cloned);
          }
        }
      }
    });
    return this.poll();
  },
  update: function(){
    return this.render(this.tgt);
  },
  render: function(n){
    var ref$, box, p;
    this.tgt = n;
    if (!n) {
      return ref$ = this.box.style, ref$.opacity = 0, ref$;
    }
    box = n.getBoundingClientRect();
    p = 6;
    return ref$ = this.box.style, ref$.left = (box.x - p) + "px", ref$.top = (box.y - p) + "px", ref$.width = (box.width + p * 2) + "px", ref$.height = (box.height + p * 2) + "px", ref$.opacity = 0.5, ref$.border = '3px solid #2be', ref$.borderRadius = '5px', ref$;
  }
});
hlh = new highlightHandler({
  target: ld$.find('#input', 0),
  menu: ld$.find('[ld-scope=highlight]', 0)
});
hlh.init();
function import$(obj, src){
  var own = {}.hasOwnProperty;
  for (var key in src) if (own.call(src, key)) obj[key] = src[key];
  return obj;
}