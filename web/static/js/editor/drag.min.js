function import$(t,e){var r={}.hasOwnProperty;for(var n in e)r.call(e,n)&&(t[n]=e[n]);return t}var dragger;import$(dragger=function(t){var e;return null==t&&(t={}),this.opt=t,e=t.root,this.root=e="string"==typeof e?document.querySelector(e):e||null,import$(this,{dragging:!1,caret:null,src:null}),this.caret={box:null,range:null},this.evtHandler={},this.init(),this},{list:[],add:function(t){return this.list.push(t)},init:function(){var t=this;if(!this.inited)return this.inited=!0,document.addEventListener("mousedown",function(e){var r;for(r=e.target;r&&(!r.hasAttribute||!r.hasAttribute("draggable"));)r=r.parentNode;if(r)return t.list.map(function(t){return t.dragInit(r)})}),document.addEventListener("dragover",function(e){var r;for(r=e.target;r&&(!r.hasAttribute||!r.hasAttribute("editable"));)r=r.parentNode;if(r)return t.list.map(function(t){return t.dropInit(r)})}),document.addEventListener("dragover",function(e){return t.list.map(function(t){return t.dragover({evt:e})})}),document.addEventListener("drop",function(e){return t.list.map(function(t){return t.drop({evt:e})})})}}),dragger.ghost=new Image,dragger.ghost.src="data:image/svg+xml,"+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="15" viewBox="0 0 20 15">\n  <rect x="0" y="0" width="20" height="15" fill="rgba(0,0,0,.5)"/>\n</svg>'),dragger.prototype=import$(Object.create(Object.prototype),{on:function(t,e){var r;return((r=this.evtHandler)[t]||(r[t]=[])).push(e)},fire:function(t){var e,r,n,i,o,a,d,s=[];for(r=[],n=1,i=arguments.length;n<i;++n)r.push(arguments[n]);for(e=r,n=0,a=(o=this.evtHandler[t]||[]).length;n<a;++n)d=o[n],s.push(d.apply(this,e));return s},init:function(){var t=this;return dragger.init(),dragger.add(this),ld$.find(this.root,"[draggable]").map(function(e){return t.dragInit(e)}),ld$.find(this.root,"[editable]").map(function(e){return t.dropInit(e)}),this.caret.box=document.createElement("div"),import$(this.caret.box.style,{position:"fixed",left:0,top:0,opacity:0,display:"none",border:"2px solid #f0f",pointerEvents:"none",transition:"opacity .15s ease-in-out",animation:"blink .4s linear infinite"}),document.body.appendChild(this.caret.box)},dropInit:function(t){var e=this;if(!(t._editor||(t._editor={})).dropInited&&ld$.parent(t,null,this.root))return(t._edtior||(t._edtior={})).dropInited=!0,t.addEventListener("drop",function(t){var r;return(r=t.dataTransfer.getData("application/json"))&&JSON.parse(r),e.dragging=!1,t.preventDefault()}),t.addEventListener("dragover",function(t){return t.preventDefault()})},dragInit:function(t){var e=this;if(!(t._editor||(t._editor={})).dragInited&&ld$.parent(t,null,this.root))return(t._editor||(t._editor={})).dragInited=!0,t.setAttribute("draggable",!0),t.addEventListener("dragstart",function(r){return e.src=t,r.dataTransfer.setData("application/json",JSON.stringify({})),r.dataTransfer.setDragImage(dragger.ghost,10,10),e.dragging=!0,r.stopPropagation()})},render:function(t){var e,r;return this.caret.range=t,t?(r=t.getBoundingClientRect(),import$(this.caret.box.style,{left:r.x+"px",top:r.y+"px",width:"1px",height:r.height+"px",display:"block",opacity:1})):(e=this.caret.box.style,e.display="none",e.opacity=0,e)},dragover:function(t){var e,r;return e=t.evt,ld$.parent(e.target,null,this.root)?(r=caretRange({node:this.root,x:e.clientX,y:e.clientY}),this.render(r.range)):this.render(null)},drop:function(t){var e,r,n,i,o,a,d,s,u,l=this;if(e=t.evt,r=this.caret.range,this.render(null),r&&ld$.parent(e.target,null,this.root)){if(n=r.startContainer,i=r.startOffset,o=n.nodeType===Element.TEXT_NODE?n:n.childNodes[i],a=this.src){if(ld$.parent(o,null,a))return;return o.nodeType===Element.TEXT_NODE?(a.parentNode.removeChild(a),u=o.textContent,[document.createTextNode(u.substring(0,i)),a,document.createTextNode(u.substring(i))].map(function(t){return o.parentNode.insertBefore(t,o)}),o.parentNode.removeChild(o)):(a.parentNode.removeChild(a),o.parentNode.insertBefore(a,o)),this.fire("change")}return"block"===(d=(s=e.dataTransfer.getData("application/json"))?JSON.parse(s):{}).type?blocktmp.get({name:d.data.name}).then(function(t){return deserialize(t)}).then(function(t){return o.parentNode.insertBefore(t.node,o),l.fire("change")}).catch(function(t){return console.log(t)}):void 0}}});