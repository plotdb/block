function import$(t,e){var i={}.hasOwnProperty;for(var n in e)i.call(e,n)&&(t[n]=e[n]);return t}var json0,store,editor,ed1;json0=require("ot-json0"),(store={state:{old:{},cur:{},tree:{}},get:function(){return JSON.parse(JSON.stringify(this.state.tree))},set:function(t){return this.state.tree=JSON.parse(JSON.stringify(t)),this.state.cur=JSON.parse(JSON.stringify(t))},add:function(t){return(this.list||(this.list=[])).push(t)},notify:function(t,e){return(this.list||(this.list=[])).map(function(i){if(e!==i)return i.opsIn(t)})},update:function(t,e){return json0.type.apply(this.state.tree,t),this.notify(t,e)}}).set(serialize(ld$.find("#sample > div",0))),import$(editor=function(t){var e=this;return null==t&&(t={}),this.opt=t,this.root=t.root,this.active=null,this.state={old:{},cur:{},tree:{}},this.root.addEventListener("input",debounce(500,function(){return e.opsOut()})),this.dragger=new dragger({root:t.root}),this.dragger.on("change",debounce(350,function(){return e.opsOut()})),this.init(),this},{inited:!1,init:function(){var t=this;if(!this.inited)return document.addEventListener("click",function(e){return t.onclick(e)}),this.inited=!0},list:[],add:function(t){return(this.list||(this.list=[])).push(t)},setHighlight:function(t){return this.highlight=t},onclick:function(t){if(!(this.list||(this.list=[])).map(function(e){return e.onclick(t)}).reduce(function(t,e){return t||e},!1))return this.highlight.mode("hover"),this.list.map(function(t){return t.toggle(!1)});this.highlight.mode("edit")}}),editor.prototype=import$(Object.create(Object.prototype),{init:function(){return editor.init(),editor.add(this),store.add(this),this.state.tree=store.get(),this.state.cur=store.get(),this.opsIn()},toggle:function(t){if(this.active)return this.active.setAttribute("contenteditable",t)},onclick:function(t){var e,i,n,r;if(e=ld$.parent(t.target,"[editable]"),ld$.parent(e,null,this.root)&&(this.active&&this.active!==e&&this.active.setAttribute("contenteditable",!1),this.active=e,e))return e.setAttribute("contenteditable",!0),!(!(i=window.getSelection()).rangeCount||(n=i.getRangeAt(0),i.isCollapsed||!ld$.parent(n.commonAncestorContainer,null,this.active)))||(ld$.find(e,"[editable]").map(function(t){return t.setAttribute("contenteditable",!1)}),r=caretRange({node:e,x:t.clientX,y:t.clientY}),setCaret(r.range),!0)},opsOut:function(){var t,e;return t=serialize(this.root.childNodes[0]),this.state.old=this.state.cur,this.state.cur=t,e=json0OtDiff(this.state.old,this.state.cur),json0.type.apply(this.state.tree,e),store.update(e,this)},opsIn:function(t){var e=this;return null==t&&(t=[]),json0.type.apply(this.state.cur,t),json0.type.apply(this.state.tree,t),deserialize(this.state.tree).then(function(t){var i;return i=t.node,e.root.innerHTML="",e.root.appendChild(i)})}}),ed1=new editor({root:ld$.find("#editor1",0)}),debounce(1e3).then(function(){return new editor({root:ld$.find("#editor2",0)})});